# TEA Project 可信执行与验证平台

## Abstract

TEA 和茶叶没有关系，它是 Trusted Execution & Attestation的缩写。它是一种以区块链共识和可信硬件为可信根基础的云计算/边缘计算的运行环境。它可以在分布式情况下在云服务商，开发者和消费者之间建立起去中心化的信任。从而以很低的成本实现可信计算和隐私计算的目的。

## 背景和待解决的问题

云计算是目前绝大多数互联网应用的基础。大致的模式是这样的：开发者编写软件代码，部署在云服务商的数据中心，消费者下载浏览器或者手机客户端运行本地App。服务器和用户本地App之间通过互联网交换和处理信息从而提供互联网服务。

这种模式是以非技术验证型为基础的信任模式。

举例说明：
- 消费者需要相信开发者没有隐藏代码或者后门窃取其私密信息
- 开发者和消费者要相信云服务商提供正确的计算结果并保护隐私和知识产权
- 云服务商需要相信开发商的代码没有能力攻击和破坏其云安全系统
- 整个通讯和存储环节都足够安全可以抵御黑客攻击

以上的假设很大程度上是基于对商业信誉的信任而不是技术验证。这种信任存在很大的不确定性。一方面的确经常发生隐私泄漏的事故，譬如Facebook和Equifax信用局的隐私泄密；另一方面这种信任很容易被政治和舆论所左右，譬如视频会议系统Zoom被美国很多机构禁用。

从技术上来讲，目前这样的中心化云计算技术架构是无法避免上述的信任问题的。于是必须寻找基于去中心化共识和物理法则的信任基础。因为这两种信任根都不是基于对人或者人类机构的信任，而是不以人的意志为转移的。

我们正在设计的就是基于这两种信任根建立起来的云计算/边缘计算可信和验证环境。消费者，开发者和云服务商不需要互相了解和信任，仍然可以安全的运行互联网应用，保证结果正确和隐私不被泄漏。

## 以往解决方案

可信计算和隐私计算都不是新出现的问题。人类从来都对自己发明的计算机存在隐忧。尤其是近年来随着人工智能技术的发展，人类越来越严重依赖计算机和他们之间组成的互联网。为了保证计算结果是可信的，计算过程中没有隐私泄漏，已经有各种类型的技术被研究和尝试。

常见的有技术密码学算法的：比如多方安全计算，全同态加密，零知识验证等数学方法。虽然这些方法可以提高数学上严谨的安全性证明，但是同时带来了巨大的计算量的浪费。很简单的四则运算都会变成上万上亿倍的复杂计算从而造成这些技术难以应用于日常的通用计算情景。

与此同时另外两种技术：可信计算和区块链正在计算机安全和去中心化金融领域获得广泛应用。其中可信计算是基于硬件可信芯片的安全性提供硬件可信根，而区块链是基于去中心化的共识协议来提供去中心化的信任。

还有第三种最近两年开始流行的代码运行标准 WebAssembly更是提供新型的安全性和便携性。

## 我们的解决方案

我们通过把这三种技术结合在一起，创建了TEA Project。开发者使用任何兼容的计算机语言和开发工具编译成为WebAssembly格式的代码包(wasm)。部署在基于硬件TPM芯片的可信计算节点上。可信计算节点之间组成一个去中心化的区块链网络(Tea Chain)，互相远程验证其他节点提供的可信证明（Tea PoT: Proof of Trust)并进行共识。消费者和开发者只需要检查区块链上的共识结果就可以相信计算环境是可信的，隐私是被保护的。

## 技术概览

我们使用Substrate来构建我们的共有区块链Tea Chain。虽然是公链但是只有可以提供基于TPM芯片的PoT的节点才可以通过其他节点的验证共识最终加入这个计算网络。这个许可是基于算法而不是人为审批的。所以我们仍然认为是一个有许可的公链。在这个Tea Chain上不会运行客户的智能合约。客户的代码是运行在可信计算环境下。Tea Chain中运行的是基于远程验证共识的奖惩逻辑和信用分数与代币逻辑。

任何安装有符合TCG2.0(Trusted Computing Group)规范的TPM芯片的计算设备都可以加入Tea Chain。目前绝大多数电脑和手机都已经安装了各种类型的TPM芯片。其中最近几年生产的也都兼容TCG2.0标准。

为了把TCB（Trust Compute Base)缩小到安全极限，我们要求这个参与节点必须专职来进行可信计算服务。所以我们定制了一个极简化的操作系统内核Linux Kernel。这个甚至不能被称为是完整的操作系统，因为它只能运行我们自己设计的Wasm Runtime和TPM驱动。除此以外的所有功能概不提供，而必须依赖网络或者Host主机的支持。这样一个定制的微型内核拥有最小的攻击面。

TEA runtime是一个与WASI标准兼容的Wasm Runtime。除了基本的Wasm Runtime功能之外，还内置了几个核心模块：
- TPM芯片的通讯接口
- Tea Chain的通讯接口
- 远程验证的逻辑模块
- 按需提供PoT的模块
- 按需装载和监督执行Guest Wasm的模块

## 计算服务方（矿工）使用场景

愿意提供计算环境和计算资源并获取报偿激励的运营者俗称矿工。在云计算的情况下，阿里巴巴和亚马逊就是矿工。只不过在去中心化的时代，我们不再需要基于巨型企业提供信用，而是使用数学和物理法则的信用。所以任何人都可以自己组装一台符合要求的计算设备来参与计算服务，从而当"矿工"。这种硬件的成本也是微乎其微。我们测试的时候使用的是35美元的树莓派单板机。如果未来可以成规模的生产专用的计算单元，每个单元的成本加上TPM芯片（目前成本大约1美元）应该会降到30美元以下。相对于目前需要很强计算能力作为门槛的BTC挖矿，TEA更在意的是随机性和时间积累。所以门槛很低。

自行组装或者购买这样的计算单元，安装免费的Tea Runtime应用即可成为一个矿机。这个矿机最好可以搭配一台现有的IPFS矿机一起使用。因为IPFS可以提供快速的网络和海量存储。在计算任务竞争方面具有很大的优势。 所以说典型的Tea矿工很可能是一个已经是IPFS矿工增配低成本的TEA矿机加入TEA Chain。

## 开发者使用场景

开发者仍然可以使用其已有的计算机语言和开发工具，但是最终制作部署包的时候需要编译成为Wasm格式的执行代码。部署方式会比云计算部署大为简化，只需要把代码存储在譬如IPFS之类的开放存储环境即可。

因为不再需要从云计算服务商租用服务器，开发者需要兑换Tea Chain的代币以支付计算Gas给矿工。因为只有在计算的时候才有消耗，所以属于Utility类型。为了充分利用到这种新型技术框架的优点，开发者最好可以理解Lamda这种函数编程的概念。并使用我们提供的开发工具来优化代码。从应用逻辑上也需要考虑利用边缘计算带来的"就近计算"的好处。这样才能充分发挥整个新技术的优势。

## 消费者使用场景

消费者完全感觉不到和传统的云计算的区别。因为应用还是以前那个应用，只不过以前跑在遥远的云计算数据中心，现在跑在就近的边缘计算可信节点上。响应速度可能会更快，可以处理的数据量可能更大。看不见的好处才是重点：消费者不需要担心数据中心或者应用开发者会留后门窃取隐私信息并因此获利。

## 代币经济

Tea Chain上有两种代币。一种是Gas，等同于现实世界中的现金或者以太坊的Eth Gas。可以在交易所和其他代币法币进行兑换。用于支付计算酬劳和惩罚作弊的押金。另一种是Credit，等同于现实世界的信用分数。Credit总量恒定，与硬件TPM 的ID捆绑因此不能买卖但是可以随硬件捆绑转让。获得Credit的唯一途径是诚实完成计算任务并获得社区共识的奖励而逐步积累。作弊或者疏忽造成的不信任会严重损害信用值。信用值和节点的盈利能力直接挂钩。也就是说信用值本身不是钱，但是它可以代表被信任的程度从而带来挣钱的能力。

## 开发成本结构

和比特币的经济结构类似，一旦产品成熟开始上链发展，后期就不在需要很多的资金运营，而是靠矿工在经济激励下主动维护。因此主要的成本集中在前期开发和部署上。目前开发的预算还在测算之中，还很难给出一个具体的数值。如果按照2年完成上线考虑，独立开发的成本应该是10–30M之间。如果可以得到其他开源社区的赞助支持，那么成本可以下降到5–15M左右。

## 盈利机制和退出机制

目前有两种盈利模型。

一种是与BTC机制类似，早期参与者包括投资者和开发者拥有早期的Credit和Gas Token。随着项目扩大和总量恒定的稀缺性导致价格上涨从而获益。
另一种是团队和投资伙伴自己先期参与运行的节点参与挖矿获益。为了避免集中造成的信任担忧，这个比例应该限制在比较低的范围从而鼓励更多的社区参与者。尽管如此，因为早期获得Credit相对容易，具有很大的成本优势。

## 退出机制

退出机制的三种思路。

一种是类似加密货币的思路。通过加密货币交易所退出。

另一种是传统硅谷科技公司的股权机制。通过未来的并购技术转让和上市获得收益。

第三种属于比较新颖的，就是通过早期培育的高信用计算节点转让获得收益。可以参照商业体育俱乐部之间转让明星球员的模式。

这三种方式并不互相抵触，而是同时可以使用。

## 项目进度

需求分析和底层技术尝试始于2017年。由于当时整体基础技术不成熟，在2018，2019年经历过数次失败的尝试后终于在2020年初确定了最终的可行方案。从2020年2月开始组织了数个网络上的黑客开始测试原型的开发。

计划在2020年6月可以完成一个软件模拟器的概念验证演示。目前打算那个时候开始融资。如果融资成功就可以开始设计硬件原型机和软件产品化。希望在2021年初可以开始内部网络试运行。2021年底正式首版上线。
